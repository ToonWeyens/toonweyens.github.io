<!DOCTYPE html>
<html lang="{{ page.lang | default: "en" }}" class="html" data-theme="{{ site.theme_config.appearance | default: "auto" }}">
        {%- include head.html -%}
  <body>
    <main class="page-content" aria-label="Content">
      <div class="w">

        <header>
          {% if site.theme_config.show_navbar == true %}
            {% include horizontal_list.html collection=site.data.home.navbar_entries show_toggle=site.theme_config.appearance_toggle %}
          {% endif %}

        </header>

        {{ content }}

        <div class="credits">
          {%- if site.theme_config.show_copyright == true -%}
          &copy;&nbsp;{{ "now" | date: "%Y" }}&nbsp;{{site.author.firstname}} {{site.author.lastname}}
          &nbsp;
          •
          &nbsp;
          {%- endif -%}
          {%- if site.soopr -%}
          Powered by <a href="https://www.soopr.co" target="_blank" rel="noreferrer">Soopr</a>
          &nbsp;
          •
          &nbsp;
          {%- endif -%}
          Theme adapted from&nbsp; <a href="https://github.com/abhinavs/moonwalk" target="_blank" rel="noreferrer">Moonwalk</a>
        </div>
      </div>
    </main>

    {%- if site.soopr -%}
      {%- if site.soopr.publish_token and jekyll.environment == "production" -%}
        <script async defer data-soopr-token="{{site.soopr.publish_token}}" src="https://sdk.soopr.co/soopr.js"></script>
      {%- else -%}
        <script async defer src="https://sdk.soopr.co/soopr.js"></script>
      {%- endif -%}
    {%- endif -%}
  
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

      document.addEventListener('DOMContentLoaded', () => {
          
          // --- THEME DETECTION LOGIC ---
          const htmlTag = document.documentElement;
          const currentAttr = htmlTag.getAttribute('data-theme');
          const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
          
          let myTheme = 'forest'; // Default to Forest (Light)

          // If site is explicitly dark, OR site is auto and system is dark
          if (currentAttr === 'dark' || (currentAttr === 'auto' && systemDark)) {
              myTheme = 'dark';
          }
          // -----------------------------

          // Initialize with the determined theme
          mermaid.initialize({
            startOnLoad: false,
            theme: myTheme, 
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
          });

          // Render the graphs
          mermaid.run({
            querySelector: '.language-mermaid'
          });
      });
    </script>
</body>
</html>
